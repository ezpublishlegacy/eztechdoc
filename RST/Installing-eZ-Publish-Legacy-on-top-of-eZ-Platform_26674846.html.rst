#. `eZ Publish Platform 5.x <index.html>`__
#. `eZ Publish Platform
   Documentation <eZ-Publish-Platform-Documentation_1114149.html>`__
#. `Development & Administration Guides <6291674.html>`__
#. `Features <Features_12781009.html>`__
#. `Legacy code and features <Legacy-code-and-features_8323433.html>`__

eZ Publish Platform 5.x : Installing eZ Publish Legacy on top of eZ Platform
============================================================================

Created and last modified by bertrand.dunogier@ez.no on Feb 24, 2015

Unlike eZ Publish 5.x, eZ Platform does not include the Legacy stack by
default. Even though it is not officially supported, eZ Publish Legacy
can easily be installed on top of Platform using Composer.

Icon

Several ezpublish-legacy extensions are no longer installed by default,
such as ezfind. They can still be manually added to the root
``composer.json``.

 

The following steps explain how the system must be configured, and how
to install the relevant requirements

Add the composer legacy post-\*-scripts
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Edit \ ``composer.json``, and add those lines to both
``post-update-cmd`` and ``post-install-cmd`` blocks at the end:

**composer.json**

.. code:: theme:

        "scripts": {
            "post-install-cmd": [
                ...,
                "eZ\\Bundle\\EzPublishLegacyBundle\\Composer\\ScriptHandler::installAssets",
                "eZ\\Bundle\\EzPublishLegacyBundle\\Composer\\ScriptHandler::installLegacyBundlesExtensions"
            ],
            "post-update-cmd": [
                ...,
                "eZ\\Bundle\\EzPublishLegacyBundle\\Composer\\ScriptHandler::installAssets",
                "eZ\\Bundle\\EzPublishLegacyBundle\\Composer\\ScriptHandler::installLegacyBundlesExtensions"
            ],
        }

Enable EzPublishLegacyBundle
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Edit ``app/EzPublishKernel.php``, and
add \ ``new eZ\Bundle\EzPublishLegacyBundle\EzPublishLegacyBundle( $this )`` at
the end of the ``$bundles`` array. Pay close attention to
the \ ``$this`` argument. The LegacyBundle is a bit of a spoiled brat,
and has high expectations from its collaborators.

Add legacy routes
~~~~~~~~~~~~~~~~~

Edit ``app/config/routing.yml``, and add the LegacyBundle routes.

**app/config/routing.yml**

.. code:: theme:

    _ezpublishLegacyRoutes:
        resource: @EzPublishLegacyBundle/Resources/config/routing.yml

Enable legacy\_mode for your backoffice siteaccess
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The Legacy Backoffice requires the ``legacy_mode`` option to be enabled.
This can be done in
``app/config/config.yml`` or ``app/config/ezpublish.yml:``

**app/config/ezpublish.yml**

.. code:: theme:

    ez_publish_legacy:
        behat_site_admin:
            legacy_mode: true

Optional: add security rules for the Setup Wizard
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you intend to run the legacy setup wizard, you need to allow it
in \ ``app/config/security.yml``.

**app/config/security.yml**

.. code:: theme:

    ezpublish_setup:
        pattern: ^/ezsetup
        security: false

Install ezsystems/legacy-bridge
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``ezsystems/legacy-bridge`` contains the libraries previous included in
``ezsystems/ezpublish-kernel``. It must be installed using Composer:

``composer require ezsystems/legacy-bridge``

````

Document generated by Confluence on Mar 03, 2015 15:12
